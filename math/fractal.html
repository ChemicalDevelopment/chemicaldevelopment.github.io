<html>
 <meta charset="UTF-8"> 
<head>
  <title>Fractal Plotter</title>
	  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
	</head>
	<body>
      <h1> Math Pages <a href="./index.html">Index</a></h1>
    <div>
      <p>
        On this page: draw a fractal!
      </p>
    </div>
    <div id="sel" style="float: left;">
      Min x: <input type="number" id="min_x" value="-3" step="0.00000001">
      Max x: <input type="number" id="max_x" value="1" step="0.00000001"><br><br>
      Min y: <input type="number" id="min_y" value="-2.5" step="0.00000001">
      Max y: <input type="number" id="max_y" value="2.5" step="0.00000001"><br><br>
      Max iterations: <input type="text" id="it" value="12" step="1" size=11><br><br>
      Escape Radius: <input type="text" id="esc" value="2" step=".01" size=11><br><br>
      f(x)=<input type="text" id="func" value="add(mul(x, x), c)" size=38><br><br>
      <br>
       <input type="button" onclick="graph()" value="Graph">
      </div>
		  <div style="float: right; padding-right: 10%">
      <canvas id="pic" width="800" height="800" style="border:1px solid #000000;"></canvas> 
    </div>
    <div id="loading">
    </div>
    <br>
    <div id="results" style="clear: both">
    </div>

	</body>
<script>
var pi = 3.14159265358979323846;

/*

Complex functions

*/

function conj(a) {
  return [a[0], - a[1]];
}

function norm(a) {
  return Math.sqrt(norm_sqr(a));
}

function norm_sqr(a) {
  return a[0] * a[0] + a[1] * a[1];
}

//scales a by b
function scale(a, b) {
  return [a[0] * b, a[1] * b];
}

function add(a, b) {
  return [a[0] + b[0], a[1] + b[1]];
}

function mul(a, b) {
  return [a[0] * b[0] - a[1] * b[1], a[0] * b[1] + a[1] * b[0]];
}

function div(a, b) {
  return mul(a, conj(b)).scale(1 / norm_sqr(a));
}

function exp(a) {
  return scale([Math.cos(a[1]), Math.sin(a[1])], Math.exp(a[0]));
}

function log(a) {
  return [Math.log(norm(a)), Math.atan(a[1] / a[0])];
}

//Replaces replaceAll
function replaceAll(str, find, replace) {
  return str.replace(new RegExp(find, 'g'), replace);
}

function graph() {
  document.getElementById("loading").innerHTML = "Please wait...";
  setTimeout(draw,5);
}


function draw() {
  var start = new Date().getTime();
  var pic = document.getElementById("pic").getContext("2d");
  var fx = document.getElementById("func").value;
  var esc_sqr = Number(document.getElementById("esc").value);
  esc_sqr *= esc_sqr;
  var max = Number(document.getElementById("it").value);
  fx = replaceAll(fx, "exp", "pp_tmp");
  fx = replaceAll(fx, "x", "iter");
  fx = replaceAll(fx, "pp_tmp", "exp");
  fx = replaceAll(fx, "c", "pic_z");
  pic.fillStyle = "#000000";
  pic.fillRect(0, 0, 800, 800);
  pic.fillStyle = "#FF0000";
  for (var x = 0; x < 800; ++x) {
    for (var y = 0; y < 800; ++y) {
      var pic_z = picToComp(x, y);
      var iter = pic_z;
      for (var t = 0; t <= max; ++t) {
        iter = eval(fx);
        if (norm_sqr(iter) >= esc_sqr) {
          break;
        }
      }
      //TODO Color
      if (t >= max - 1) {
          pic.fillRect(x,y,1,1);
      }
    }
  }
  var end = new Date().getTime();
  var time = (end - start) / 1000;
  var pixels = 800 * 800;
  document.getElementById("results").innerHTML = "Seconds: " + time + "<br>";
  document.getElementById("results").innerHTML += "MPixels/seconds: " + pixels / (1000000 * time);
  document.getElementById("loading").innerHTML = "Done!";

}

//Returns complex number based on picture coordinates
function picToComp(x, y) {
  var min_x = Number(document.getElementById("min_x").value);
  var max_x = Number(document.getElementById("max_x").value);
  var min_y = Number(document.getElementById("min_y").value);
  var max_y = Number(document.getElementById("max_y").value);
  var re_z = x * (max_x - min_x) / 800 + min_x;
  var im_z = (800 - y) * (max_y - min_y) / 800 + min_y;
  return [re_z, im_z];
}


</script>
</html>